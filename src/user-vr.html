<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title id="title">Description pending...</title>
    <meta name="description" content="VREUD Example - Aframe" />

    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.5.0/socket.io.slim.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/16.3.5/Tween.min.js"></script>
    <script src="/js/aframe-colorwheel-component.min.js"></script>
    <script src="/easyrtc/easyrtc.js"></script>
    <script src="/dist/networked-aframe.js"></script>
    <script>
      AFRAME.registerComponent('thumbstick-controls',{
        init: function () {
          this.el.addEventListener('thumbstickmoved', this.thumbstickControl);
        },
        thumbstickControl: function (evt) {

          var pos = this.getAttribute('position');

          if (evt.detail.y > 0.95) { 
            console.log("DOWN"); 
            var pos = this.el.getAttribute("position");
            pos.x = pos.x + 1;
            this.el.setAttribute("position", pos);
          }
          if (evt.detail.y < -0.95) { 
            console.log("UP"); 
          }
          if (evt.detail.x < -0.95) { 
            console.log("LEFT"); 
          }
          if (evt.detail.x > 0.95) { 
            console.log("RIGHT"); 
          }
        }
      });
    </script>
    <script>
      // see issue https://github.com/networked-aframe/networked-aframe/issues/267
      NAF.schemas.getComponentsOriginal = NAF.schemas.getComponents;
      NAF.schemas.getComponents = (template) => {
        if (!NAF.schemas.hasTemplate('#avatar-template')) {
          NAF.schemas.add({
            template: '#avatar-template',
            components: [
              'position',
              'rotation',
              {
                selector: '.head',
                component: 'material',
                property: 'color'
              }
            ]
          });

          if (!NAF.schemas.hasTemplate('#block-template')) {
            NAF.schemas.add({
              template: '#block-template',
              components: [
                'position',
                {
                  selector: '.block',
                  component: 'rotation'
                },
                {
                  selector: '.block',
                  component: 'position'
                },
                {
                  selector: '.block',
                  component: 'material',
                  property: 'color'
                },
                {
                  selector: '.block',
                  component: 'select-entity',
                  property: 'direction'
                }
              ]
            });
          }
        }

        if (!NAF.schemas.hasTemplate('#hand-right-template')) {
          NAF.schemas.add({
            template: '#hand-right-template',
            components: [
              'position',
              'rotation',
              {
                selector: '.righthand',
                component: 'material',
                property: 'color'
              }
            ]
          });
        }

        if (!NAF.schemas.hasTemplate('#hand-left-template')) {
          NAF.schemas.add({
            template: '#hand-left-template',
            components: [
              'position',
              'rotation',
              {
                selector: '.lefthand',
                component: 'material',
                property: 'color'
              }
            ]
          });
        }

        const components = NAF.schemas.getComponentsOriginal(template);
        return components;
      };
    </script>
    <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
    <script src="/js/spawn-in-circle.component.js"></script>
    <script src="/js/object-control-vr.component.js"></script>
    <script>
      let clientRtcId;

      // Called by Networked-Aframe when connected to server
      function onConnect() {        
        // Set clients easyrtcid
        clientRtcId = NAF.clientId;
        clientName = window.parent.clientName;

        // Send clientId to statusbar
        //window.parent.addUserToStatusBar(clientRtcId, true);
        serverJoinedSetup();
      }
    </script>
    <script>
      function serverJoinedSetup() {
        // Add own name to statusbar
        // TODO: Make VR ready
        //window.parent.addUserToStatusBar(clientRtcId, clientName, true);

        // Init Listeners
        easyrtc.setServerListener( function(msgType, msgData, targeting) {
          if(msgType === 'spawnComponent') {
            var newData = JSON.parse(msgData);
            var controller = document.querySelector('[object-control-vr]').components['object-control-vr'];
            controller.spawnEntity(newData);

          }else if(msgType === 'selectedComponent') {
            var data = JSON.parse(msgData);
            var cid = data.cid;
            var sourceRtcId = data.sourcertcid;
            var bool = data.bool;
            var controller = document.querySelector('[object-control-vr]').components['object-control-vr'];
            controller.selectEntity(cid, sourceRtcId, bool);

          }else if(msgType === 'removedComponent') {
            var data = JSON.parse(msgData);
            var cid = data.cid;
            var controller = document.querySelector('[object-control-vr]').components['object-control-vr'];
            controller.removeComponent(cid);
          }else if(msgType === 'updatedComponent') {
            var data = JSON.parse(msgData);
            var cid = data.cid;
            var type = data.updatetype;
            var newData = data.updatedata;
            var controller = document.querySelector('[object-control-vr]').components['object-control-vr'];
            controller.updateComponent(cid, type, newData);

          } else if(msgType === 'userJoined') {
            var data = JSON.parse(msgData);
            //window.parent.addUserToStatusBar(data.easyrtcid, data.name, false);

          }else if(msgType === 'userLeft') {
            var data = JSON.parse(msgData);
            //window.parent.removeUserFromStatusBar(data.easyrtcid);
          }
        });

        // Broadcast ClientName
        var obj = new Object();
        obj.easyrtcid = clientRtcId;
        obj.name = clientName;
        var clientData = JSON.stringify(obj);
        easyrtc.sendDataWS(clientRtcId, "broadcastUserName", clientData);

      }
    </script>
    <script>
      AFRAME.registerComponent('raycaster-listen', {
        init: function () {
          var el = this.el;
          // TODO: GET MATERIAL PROPERTY OF TEMPORARY AXIS SLIDERS
          var baseColor = this.el.getAttribute('material').color;
          this.el.setAttribute('baseColor', baseColor);
          // Use events to figure out what raycaster is listening so we don't have to
          // hardcode the raycaster.
          this.el.addEventListener('raycaster-intersected', evt => {
            this.raycaster = evt.detail.el;
          });

          this.el.addEventListener('raycaster-intersected-cleared', evt => {
            // var hand = evt.detail.el;
            var cid = this.el.getAttribute('cid');
            var intersectCid = this.el.getAttribute('intersect-cid');
            if(cid == intersectCid) {
              this.el.setAttribute('intersect-cid', null);
            }
            this.raycaster = null;
          });
        },
        
        setHoverLeave: function() {
          var cid = this.el.getAttribute('cid');
          var hand = this.raycaster;

          if(hand != null) {
            var intersectCid = this.el.getAttribute('intersect-cid');

            if(cid == intersectCid) {
              this.el.setAttribute('intersect-cid', 'null');
            }
          }
          
          // Update color
          var material = this.el.getAttribute('material');
          var currentColor = material.color;
          var baseColor = this.el.getAttribute('baseColor');

          if(currentColor != baseColor){
            material.color = baseColor;
            this.el.setAttribute('material', material);

            // Check if wireframe exists and make it visible
            if(this.el.getAttribute('wireframed') == "true") {
              var name = this.el.getAttribute('name');
              var wfObjectName = name + "-wireframe";
              var wfObjects = document.querySelectorAll("[wireframe]");
              var wfObject = null;

              wfObjects.forEach(obj => {
                var objName = obj.getAttribute('name');
                if(objName == wfObjectName) {
                  wfObject = obj;
                }
              });

              wfObject.setAttribute('visible', true);
            }
          }
        },

        setHoverOver: function() {
          var intersectCid = this.el.getAttribute('intersect-cid');
          var cid = this.el.getAttribute('cid');

          if(cid != intersectCid) {
            this.el.setAttribute('intersect-cid', cid);

            // Update color
            var material = this.el.getAttribute('material');
            var currentColor = material.color;
            var baseColor = this.el.getAttribute('baseColor');

            if(currentColor == baseColor){
              material.color = '#ffffff';
              this.el.setAttribute('material', material);

              // Check if wireframe exists and make it insivible
              if(this.el.getAttribute('wireframed') == "true") {
                var name = this.el.getAttribute('name');
                var wfObjectName = name + "-wireframe";
                var wfObjects = document.querySelectorAll("[wireframe]");
                var wfObject = null;

                wfObjects.forEach(obj => {
                  var objName = obj.getAttribute('name');
                  if(objName == wfObjectName) {
                    wfObject = obj;
                  }
                });

                wfObject.setAttribute('visible', false);
              }
            }
          }
        },

        tick: function () {
          if (!this.raycaster) { 
            this.setHoverLeave();
            return;
          }  // Not intersecting.
          
          // Check if intersecting
          let intersection = this.raycaster.components.raycaster.getIntersection(this.el);
          if (!intersection) { return; } 
          
          // Check if it is the first intersection
          var intersectionIndex = this.raycaster.components.raycaster.intersectedEls.indexOf(this.el);
          if(intersectionIndex != 0) {
            // if not first intersection, set base color
            this.setHoverLeave();
            return;
          } 
          
          this.setHoverOver();
        }
      });
    </script>
    <script>
      AFRAME.registerComponent('select-listener', {
        init: function () {
          var el = this.el;
          el.addEventListener('select-object', function handleSendSelect(event) {
            // Check if handler is 'disabled'
            var selectedBy = el.getAttribute('selectedby');
            if(selectedBy != null) {
              return;
            }

            // Check if the component is the first intersected
            var componentId = el.getAttribute('cid');
            var intersectCid = el.getAttribute('intersect-cid');
            if(componentId != intersectCid) {
              return;
            }

            // Create data object to stringify
            var obj = new Object();
            obj.cid = componentId;

            var entityData = JSON.stringify(obj); 
            
            console.log("Sending: 'Select object with component-id:' " + entityData);
            easyrtc.sendDataWS(clientRtcId, "selectComponent", entityData);
          });
        }
      });

      AFRAME.registerComponent('grab-listener', {
        init: function () {
          var el = this.el;
          el.addEventListener('grab-object-start', function handleSendSelect(event) {
            // Start moving the object
            el.setAttribute('placeable', '');
          });

          el.addEventListener('grab-object-end', function handleSendSelect(event) {
            // Stop moving the object
            el.removeAttribute('placeable');

            // Send the updated object position to server
            var obj = new Object();
            var pos = el.getAttribute('position');
            var cid = el.getAttribute('cid');
            obj.cid = cid; 
            obj.updatetype = 'position';
            obj.updatedata = pos;
            var newData = JSON.stringify(obj);
            easyrtc.sendDataWS(clientRtcId, "updateComponent", newData);
          });
          
        }
      });

      AFRAME.registerComponent('grab-axisslider-listener', {
        init: function () {
          var el = this.el;
          var axis = this.el.getAttribute('axis');
          el.addEventListener('grab-object-start', function handleSendSelect(event) {
            // Start moving the object
            el.setAttribute('axis-grabbed', 'axis: ' + axis);
          });

          el.addEventListener('grab-object-end', function handleSendSelect(event) {
            // Stop moving the object
            el.removeAttribute('axis-grabbed');

            // Send the updated object position to server
            var obj = new Object();
            var pos = el.getAttribute('position');
            var cid = el.getAttribute('cid');
            obj.cid = cid; 
            obj.updatetype = 'position';
            obj.updatedata = pos;
            var newData = JSON.stringify(obj);
            easyrtc.sendDataWS(clientRtcId, "updateComponent", newData);
          });
        }
      });

      AFRAME.registerComponent('axis-grabbed', {
        schema: {
          axis: { default: "x" }
        },
        init: function () {
          var axis = this.data.axis;
        },

        tick: function () {
          var hand = null;
          var raycaster = null;
          var el = this.el;
          var pEl = el.parentEl;
          var axis = this.data.axis;
          var debug = document.getElementById('debugtext');
                    
          try {
            hand = document.getElementById('hand-right');
            raycaster = hand.components.raycaster;
          }catch(e) {
            return;
          }

          if(raycaster == null) {
            return;
          }

          // Handle Position
          var pos3 = hand.getAttribute('position');
          var tempPos3 = pos3.clone();
          var quaternion = raycaster.el.object3D.quaternion;
          var vector = new THREE.Vector3(0, 0, -1);
          vector.applyQuaternion( quaternion );
          tempPos3 = tempPos3.add(vector);
          
          var pPosition3 = pEl.getAttribute('position');
          var newPos3 = pPosition3.clone();
          newPos3[axis] = tempPos3[axis];
          el.setAttribute('position', newPos3);
        }
      });

      AFRAME.registerComponent('trigger-button-listener', {
        init: function () {
          const selectObjectEvent = new Event("select-object");

          var el = this.el;
          //el.addEventListener('click', function (evt) { // Testing with Mouse
          el.addEventListener('triggerdown', function (evt) { // Actual implementation
            // Get raycaster
            var rc = el.components.raycaster;
            
            // Get intersections
            var intersectedEls = rc.intersectedEls;
            if(intersectedEls.length < 1) {
              return;
            }
            
            // Get first intersection
            var firstHit = rc.intersectedEls[0];

            // Trigger event 'Send select'
            firstHit.dispatchEvent(selectObjectEvent);
          });
        }
      });

      AFRAME.registerComponent('grip-button-listener', {
        init: function () {
          const grabObjectStartEvent = new Event("grab-object-start");
          const grabObjectEndEvent = new Event("grab-object-end");

          var el = this.el;
          var firstHit;
          el.addEventListener('gripdown', function (evt) { 
            // Get raycaster
            var rc = el.components.raycaster;
            
            // Get intersections
            var intersectedEls = rc.intersectedEls;
            if(intersectedEls.length < 1) {
              return;
            }
            
            // Get first intersection
            firstHit = rc.intersectedEls[0];

            // Trigger event 'Start Grab Object'
            firstHit.dispatchEvent(grabObjectStartEvent);
          });
          
          el.addEventListener('gripup', function (evt) { 
            // Trigger event 'End Grab Object'
            if(firstHit == null) {
              return;
            }
            firstHit.dispatchEvent(grabObjectEndEvent);
          });
        }
      });

      AFRAME.registerComponent('a-button-listener', {
        init: function () {
        }
      });

      AFRAME.registerComponent('b-button-listener', {
        init: function () {
          var el = this.el;
          el.addEventListener('bbuttondown', function (evt) {
            // Hide virtual controller
            el.setAttribute('visible', !el.getAttribute('visible'));
          });
        }
      });

      AFRAME.registerComponent('x-button-listener', {
        init: function () {
          var el = this.el;
          
          var mainmenu = document.getElementById('container-vr-menu');

          el.addEventListener('xbuttondown', function (evt) {
            mainmenu.setAttribute('visible', !mainmenu.getAttribute('visible'));
          });
        }
      });

      AFRAME.registerComponent('y-button-listener', {
        init: function () {
          var el = this.el;
          el.addEventListener('ybuttondown', function (evt) {
            // Hide virtual controller
            el.setAttribute('visible', !el.getAttribute('visible'));
          });
        }
      });

      AFRAME.registerComponent('thumbstick-object-listener', {
        init: function () {
          var el = this.el;
          var hand = document.getElementById('hand-right');
          el.addEventListener('thumbstickdown', function (evt) {
            var multiplier = hand.getAttribute('range-multiplier');
            if(multiplier < 0.2 || multiplier > 5) {
              return;
            }
            hand.setAttribute('range-multiplier', multiplier + 0.2);
          });
        }
      });
    </script>
    <script>
       AFRAME.registerComponent("priority", {
        schema: {
          level: {default: "standard"}
        },
        dependencies: ['material'],
        init: function () {
          var level = this.data.level;
          this.el.sceneEl.renderer.sortObjects = true;
          this.el.components.material.material.depthTest = false;
          var renderOrder;
          switch (level) {
            case "standard":
              renderOrder = 0;
              break;
            case "wireframe":
              renderOrder = 10;
              break;
            case "selected":
              renderOrder = 20;
              break;
            case "hud":
              renderOrder = 30;
              break;
            default:
              break;
          }
          this.el.object3D.renderOrder = renderOrder;
        }
      });
    </script>

    <!-- VR Menu -->
    <script>
      AFRAME.registerComponent("placeable", {
        init: function () {
          var el = this.el;
        },

        tick: function () {
          var hand = null;
          var raycaster = null;
          var el = this.el;
          var debug = document.getElementById('debugtext');
                    
          try {
            hand = document.getElementById('hand-right');
            raycaster = hand.components.raycaster;
          }catch(e) {
            return;
          }

          if(raycaster == null) {
            return;
          }

          // Handle Position
          var multiplier = hand.getAttribute('range-multiplier');
          var pos3 = hand.getAttribute('position');
          var newPos3 = pos3.clone();
          var quaternion = raycaster.el.object3D.quaternion;
          var vector = new THREE.Vector3(0, 0, -multiplier);
          vector.applyQuaternion( quaternion );
          newPos3 = newPos3.add(vector);

          el.setAttribute('position', newPos3);
          
        }
      });

      AFRAME.registerComponent("vr-menu-add", {
        init: function () {
          var el = this.el;
          var submenu = document.getElementById('container-vr-submenu-add');

          // TODO: Add refs to other submenus and make them invisible
          var otherSubMenu1;
          var otherSubMenu2;

          el.addEventListener('select-object', function handleSendSelect(event) {
            // Open or close the 'Add'-Menu
            if(submenu.getAttribute('visible') == false) {
              // TODO: make other submenus invisible
              submenu.setAttribute('visible', true);
            }else{
              submenu.setAttribute('visible', false);
            }
          });
        }
      });

      AFRAME.registerComponent("vr-submenu-add", {
        schema: {
          shape: { default: "sphere" }
        },
        init: function () {
          var el = this.el;
          var shape = this.data.shape;
          var scene = el.sceneEl;

          /*
          var hand = document.getElementById('hand-right');
          var raycaster = hand.components.raycaster;

          var quaternion = raycaster.el.object3D.quaternion;
          var debug = document.getElementById('debugtext');
          */

          el.addEventListener('select-object', function handleSendSelect(event) {
            var hand = document.getElementById('hand-right');
            var raycaster = hand.components.raycaster;

            var quaternion = raycaster.el.object3D.quaternion;
            var debug = document.getElementById('debugtext');

            // TODO: Close the GUI
            // submenu.setAttribute('visible', false);

            // Attach box to the raycaster
            var box = document.createElement('a-entity');
            box.setAttribute('class', 'collidable');

            // Handle geometry/shape attribute
            var geometry = 'primitive: ' + shape + ';';
            box.setAttribute('geometry', geometry);

            // Handle other attributes
            box.setAttribute('material', 'color: #00ff00');
            box.setAttribute('scale', '0.1 0.1 0.1');

            // Handle Position with 'placeable' attribute 
            box.setAttribute('placeable', '');

            // Add obj to scene
            scene.appendChild(box);
          });
        }
      });
      
      AFRAME.registerComponent('color-listener', {
        init: function(){
          const el = this.el;
          document.body.addEventListener('didchangecolor', function(evt){

              //Available return formats from colorwheel
              let style = evt.detail.style
              let rgb = evt.detail.rgb
              let hsv = evt.detail.hsv
              let hex = evt.detail.hex

              //el.setAttribute('color', hex)
              el.setAttribute('material', 'color: ' + hex)
              el.setAttribute('basecolor', hex)
          })
        }
      })
    </script>
    <script>
      AFRAME.registerComponent('mimic-head-color', {
        init: function () {
          
        },

        tick: function() {
          var nafEntities = NAF.entities.entities;
          var objProperties = Object.getOwnPropertyNames(nafEntities);
          var ownNetworkedPlayerObject;

          if(objProperties == null || objProperties.length < 1) {
            return;
          }

          objProperties.forEach((property) => {
            var entity = nafEntities[property];
            if(entity.getAttribute('id') == 'player') {
              ownNetworkedPlayerObject = entity;
            }
          });

          var material = ownNetworkedPlayerObject.children[0].getAttribute('material');

          var el = this.el;
          el.setAttribute('material', material);
          el.removeAttribute('mimic-head-color');
        }
      });
    </script>
    <script>
      AFRAME.registerComponent('test-comp', {
        init: function () {
          var el = this.el;
          /* REMOVE FAULTY PLANE FROM COLORWHEEL
          var faultyPlane = el.children[1];
          faultyPlane.remove();
          console.log(el);
          //*/


        }
      });
    </script>
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
  </head>
  <body>
    <a-scene
      networked-scene="
        room: dev;
        debug: true;
        adapter: easyrtc;
        audio: true;
      "
    >
      <a-assets>
        <!-- Templates -->

        <!-- Avatar -->
        <template id="avatar-template">
          <a-entity class="avatar" networked-audio-source>
            <a-sphere class="head" scale="0.45 0.5 0.4"></a-sphere>
            <a-entity class="face" position="0 0.05 0">
              <a-sphere class="eye" color="#efefef" position="0.16 0.1 -0.35" scale="0.12 0.12 0.12">
                <a-sphere class="pupil" color="#000" position="0 0 -1" scale="0.2 0.2 0.2"></a-sphere>
              </a-sphere>
              <a-sphere class="eye" color="#efefef" position="-0.16 0.1 -0.35" scale="0.12 0.12 0.12">
                <a-sphere class="pupil" color="#000" position="0 0 -1" scale="0.2 0.2 0.2"></a-sphere>
              </a-sphere>
            </a-entity>
          </a-entity>
        </template>

        <template id="hand-right-template">
          <a-entity class="rightarm">
            <a-box class="righthand" scale="0.2 0.2 0.2"></a-box>
          </a-entity>
        </template>

        <template id="hand-left-template">
          <a-entity class="leftarm">
            <a-box class="lefthand" scale="0.2 0.2 0.2"></a-box>
          </a-entity>
        </template>

        <!-- Entity -->
        <template id="block-template">
          <a-entity>
            <a-box class="block"></a-box>
          </a-entity>
        </template>

        <!-- Grid -->
        <img id="grid" src="/img/grid.png">
        <img id="sky" src="/img/sky.jpg">

        <!-- GUI -->
        <img id="plus" src="/img/plus.png">
      </a-assets>


      <a-entity id="rig">
        <a-entity
          id="player"
          networked="template:#avatar-template;attachTemplateToLocal:false;"
          camera
          position="0 1.6 0"
          spawn-in-circle="radius:3"
          object-control-vr="template:#block-template"
          look-controls
          wasd-controls
          cursor
        >
          <a-sphere id="playerhead" class="head" visible="false" random-color></a-sphere>
          <a-cursor></a-cursor>
        </a-entity>
        
        <a-entity 
          id="hand-right"
          name="hand-right"
          class="hand-right"
          networked="template:#hand-right-template;attachTemplateToLocal:false;"
          rotation="0 0 0"
          range-multiplier="1";
          oculus-touch-controls="hand: right"
          a-button-listener
          b-button-listener
          grip-listener
          trigger-listener
          thumbstick-object-listener
          raycaster="objects: .collidable,
                              .axis-slider,
                              .vr-menu, 
                              .vr-menu-add, 
                              .vr-submenu-add, 
                              .vr-submenu-add-box,
                              .vr-submenu-add-cyllinder,
                              .vr-submenu-add-plane,
                              .vr-submenu-add-sphere; 
                              showLine: true"
        >
          <!-- NAF Hand -->
          <a-entity class="righthand" visible="false" mimic-head-color></a-entity>
        </a-entity>

        <a-entity 
          id="hand-left"
          name="hand-left"
          class="hand-left"
          networked="template:#hand-left-template;attachTemplateToLocal:false;"
          oculus-touch-controls="hand: left"
          x-button-listener
          y-button-listener
        >
          <!-- NAF Hand -->
          <a-entity class="lefthand" visible="false" mimic-head-color></a-entity>

          
          

          <!-- VR MENU -->
          <a-entity scale="0.5 0.5 0.5" rotation="-45 0 0" visible="false">
            <a-colorwheel position="0 1 0" showhexvalue="true" showswatches="true"></a-colorwheel>
          </a-entity>

          <a-entity 
            id="container-vr-menu"
            scale="0.1 0.1 0.1"
            rotation="-45 0 0"
            visible="true"
          >
            <a-entity
              class="vr-menu" 
              geometry="primitive: plane"
              material="color: #323236"
              position="0 0 0"
              rotation="0 0 0" 
              scale="1 3 1"
              visible="true"
              priority="level: hud"
            ></a-entity>
            
            <!-- Menu ADD -->
            <a-entity
              position="0 -1 0"
              rotation="0 0 0" 
              scale="0.9 0.9 0.1"
            >
              <a-entity
                class="vr-menu-add" 
                geometry="primitive: box"
                material="color: #0377fc"
                visible="true"
                priority="level: hud"
                raycaster-listen
                vr-menu-add
              ></a-entity>
              <a-entity
                class="vr-menu-add-img" 
                geometry="primitive: plane"
                material="src: #plus; transparent: true"
                visible="true"
                priority="level: hud"
              ></a-entity>
            </a-entity>

            <!-- Submenu ADD -->
            <a-entity
              id="container-vr-submenu-add" 
              position="2.05 0 0" 
              scale="3 3 1"
            >  
              <a-entity
                class="vr-submenu-add"
                geometry="primitive: plane"
                material="color: #31b5cc"
                rotation="0 0 0" 
                visible="true"
                priority="level: hud"
              ></a-entity>

              <!-- Submenu ADD BOX -->
              <a-entity
                id="container-vr-submenu-add-box" 
                position="-0.3 0.3 0"
                rotation="0 0 0" 
                scale="0.3 0.3 0.1"
                priority="level: hud"
              >
                <a-entity
                  class="vr-submenu-add-box" 
                  geometry="primitive: box"
                  material="color: #0377fc"
                  visible="true"
                  priority="level: hud"
                  raycaster-listen
                  vr-submenu-add="shape: box"
                ></a-entity>
                <a-entity
                  class="vr-submenu-add-box-img" 
                  geometry="primitive: plane"
                  material="src: #plus; transparent: true"
                  visible="true"
                  priority="level: hud"
                ></a-entity>
              </a-entity>
            </a-entity>
          </a-entity>
        </a-entity>
      </a-entity>


      <a-entity name="o1" class="collidable" geometry="primitive: box" material="color: #0000ff" raycaster-listen position="5 0 0"></a-entity>
      <a-entity name="o2" class="collidable" geometry="primitive: box" material="color: #00ff00" raycaster-listen position="5.5 0.5 0.5" wireframed="true"></a-entity>
      <a-entity name="o2-wireframe" geometry="primitive: box" material="color: #ff0000; wireframe: true" wireframe priority="level: wireframe" position="5.5 0.5 0.5"></a-entity>
      <a-entity name="floor" geometry="primitive: plane" material="color: #51524c" rotation="-90 0 0" scale="6 6 0.1" position="0 -1 0"></a-entity>
      <a-text id='debugtext' value="DEBUG TEXT" geometry="primitive: plane;" material="color: #20d67e" position="0 1 -6"></a-text>

      <!--a-entity networked="template:#hand-right-template;attachTemplateToLocal:true;" test-comp></a-entity-->
      
      <!--a-entity geometry="primitive: box" placeable position="3 0 0" scale="0.2 0.2 0.2"></a-entity-->
      

      <!-- Environment -->
      <!--a-entity 
        position="0 -0.95 0" geometry="primitive: plane; width: 10000; height: 10000;" rotation="-90 0 0"
        material="src: #grid; repeat: 10000 10000; transparent: true; metalness:0.6; roughness: 0.4; sphericalEnvMap: #sky;"
      ></a-entity-->
      <a-entity light="color: #ccccff; intensity: 1; type: ambient;" visible=""></a-entity>
      <a-entity light="color: #ffaaff; intensity: 1.5" position="5 5 5"></a-entity>
      <a-sky src="#sky" rotation="0 -90 0"></a-sky>
    </a-scene>

    <div class="controls">
      <p>Description pending...</p>
    </div>
  </body>
</html>
